<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Product Details - Santaverse</title>
    <link rel="stylesheet" href="/css/style.css">
</head>

<body>
    <header>
        <a href="/" class="header-brand" style="text-decoration: none; color: inherit;">
            <img src="/img/logo_nitro_reindeer.png" alt="Santaverse Logo">
            <h1>Santaverse Garage</h1>
        </a>
        <nav>
            <a href="/">Marketplace</a>
            <a href="/garage">My Garage</a>
        </nav>
    </header>

    <main>
        <div id="product-container" class="detail-container">
            <p>Loading details...</p>
        </div>
    </main>

    <script src="/js/app.js"></script>
    <script>
        document.addEventListener('DOMContentLoaded', async () => {
            const params = new URLSearchParams(window.location.search);
            const id = params.get('id');
            const container = document.getElementById('product-container');

            if (!id) {
                container.innerHTML = '<p>Item not selected.</p>';
                return;
            }

            try {
                const item = await fetchItemDetails(id);
                container.innerHTML = `
                    <div class="detail-img-container">
                        <img src="${item.image_url}" alt="${item.name}" class="detail-img">
                    </div>
                    <div class="detail-content">
                        <span class="card-category">${item.category} ${item.type}</span>
                        <h2>${item.name}</h2>
                        <span class="price-tag">ðŸª™ ${item.price}</span>
                        
                        <div class="detail-description">
                            "Experience the magic of the North Pole with the ${item.name}. 
                            Engineered for ${item.category.toLowerCase()} performance and reliable gift delivery."
                        </div>

                        <div class="features-box">
                            <h3>Performance Specs</h3>
                            ${formatStats(item.stats)}
                            <p style="margin-top: 1rem; font-size: 0.9rem;"><strong>Best Suited For:</strong> ${getBestSuitedFor(item)}</p>
                        </div>

                        <button onclick="handleBuy(${item.id})" class="btn btn-danger" style="width: 100%; font-size: 1.1rem; padding: 1rem;">
                            Purchase for Santa's Fleet
                        </button>
                    </div>
                `;
            } catch (err) {
                container.innerHTML = `<p style="color:red">Error: ${err.message}</p>`;
            }
        });

        function getBestSuitedFor(item) {
            if (item.type === 'reindeer') {
                if (item.category === 'Performance') return 'High-speed roof hopping';
                if (item.category === 'Luxury') return 'VIP gift delivery';
                return 'Short-range town runs';
            } else {
                if (item.category === 'Luxury') return 'Trans-continental comfort';
                if (item.category === 'Performance') return 'Time-critical missions';
                return 'Heavy cargo hauling';
            }
        }

        async function handleBuy(id) {
            if (confirm('Buy this item for your garage?')) {
                try {
                    await buyItem(id);
                    alert('Purchase successful! Moved to Garage.');
                    window.location.href = '/garage';
                } catch (err) {
                    alert('Failed to buy: ' + err.message);
                }
            }
        }
    </script>
</body>

</html>